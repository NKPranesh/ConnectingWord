{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { assert } from '../env-utils/assert';\nexport default class WorkerJob {\n  constructor(jobName, workerThread) {\n    _defineProperty(this, \"name\", void 0);\n\n    _defineProperty(this, \"workerThread\", void 0);\n\n    _defineProperty(this, \"isRunning\", void 0);\n\n    _defineProperty(this, \"result\", void 0);\n\n    _defineProperty(this, \"_resolve\", void 0);\n\n    _defineProperty(this, \"_reject\", void 0);\n\n    this.name = jobName;\n    this.workerThread = workerThread;\n    this.isRunning = true;\n\n    this._resolve = () => {};\n\n    this._reject = () => {};\n\n    this.result = new Promise((resolve, reject) => {\n      this._resolve = resolve;\n      this._reject = reject;\n    });\n  }\n\n  postMessage(type, payload) {\n    this.workerThread.postMessage({\n      source: 'loaders.gl',\n      type,\n      payload\n    });\n  }\n\n  done(value) {\n    assert(this.isRunning);\n    this.isRunning = false;\n\n    this._resolve(value);\n  }\n\n  error(error) {\n    assert(this.isRunning);\n    this.isRunning = false;\n\n    this._reject(error);\n  }\n\n}","map":{"version":3,"sources":["../../../../src/lib/worker-farm/worker-job.ts"],"names":["constructor","postMessage","source","payload","done","assert","error"],"mappings":";AAEA,SAAA,MAAA,QAAA,qBAAA;AAKA,eAAe,MAAA,SAAA,CAAgB;AAU7BA,EAAAA,WAAW,CAAA,OAAA,EAAA,YAAA,EAA8C;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,MAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,cAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,WAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,QAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,UAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,SAAA,EAAA,KAAA,CAAA,CAAA;;AACvD,SAAA,IAAA,GAAA,OAAA;AACA,SAAA,YAAA,GAAA,YAAA;AACA,SAAA,SAAA,GAAA,IAAA;;AACA,SAAA,QAAA,GAAgB,MAAM,CAAtB,CAAA;;AACA,SAAA,OAAA,GAAe,MAAM,CAArB,CAAA;;AACA,SAAA,MAAA,GAAc,IAAA,OAAA,CAAY,CAAA,OAAA,EAAA,MAAA,KAAqB;AAC7C,WAAA,QAAA,GAAA,OAAA;AACA,WAAA,OAAA,GAAA,MAAA;AAFF,KAAc,CAAd;AAID;;AAMDC,EAAAA,WAAW,CAAA,IAAA,EAAA,OAAA,EAA+D;AACxE,SAAA,YAAA,CAAA,WAAA,CAA8B;AAC5BC,MAAAA,MAAM,EADsB,YAAA;AAAA,MAAA,IAAA;AAG5BC,MAAAA;AAH4B,KAA9B;AAKD;;AAKDC,EAAAA,IAAI,CAAA,KAAA,EAAc;AAChBC,IAAAA,MAAM,CAAC,KAAPA,SAAM,CAANA;AACA,SAAA,SAAA,GAAA,KAAA;;AACA,SAAA,QAAA,CAAA,KAAA;AACD;;AAKDC,EAAAA,KAAK,CAAA,KAAA,EAAc;AACjBD,IAAAA,MAAM,CAAC,KAAPA,SAAM,CAANA;AACA,SAAA,SAAA,GAAA,KAAA;;AACA,SAAA,OAAA,CAAA,KAAA;AACD;;AAlD4B","sourcesContent":["import type {WorkerMessageType, WorkerMessagePayload} from '../../types';\nimport WorkerThread from './worker-thread';\nimport {assert} from '../env-utils/assert';\n\n/**\n * Represents one Job handled by a WorkerPool or WorkerFarm\n */\nexport default class WorkerJob {\n  readonly name: string;\n  readonly workerThread: WorkerThread;\n  isRunning: boolean;\n  /** Promise that resolves when Job is done */\n  readonly result: Promise<any>;\n\n  private _resolve: (value: any) => void;\n  private _reject: (reason?: any) => void;\n\n  constructor(jobName: string, workerThread: WorkerThread) {\n    this.name = jobName;\n    this.workerThread = workerThread;\n    this.isRunning = true;\n    this._resolve = () => {};\n    this._reject = () => {};\n    this.result = new Promise((resolve, reject) => {\n      this._resolve = resolve;\n      this._reject = reject;\n    });\n  }\n\n  /**\n   * Send a message to the job's worker thread\n   * @param data any data structure, ideally consisting mostly of transferrable objects\n   */\n  postMessage(type: WorkerMessageType, payload: WorkerMessagePayload): void {\n    this.workerThread.postMessage({\n      source: 'loaders.gl', // Lets worker ignore unrelated messages\n      type,\n      payload\n    });\n  }\n\n  /**\n   * Call to resolve the `result` Promise with the supplied value\n   */\n  done(value): void {\n    assert(this.isRunning);\n    this.isRunning = false;\n    this._resolve(value);\n  }\n\n  /**\n   * Call to reject the `result` Promise with the supplied error\n   */\n  error(error): void {\n    assert(this.isRunning);\n    this.isRunning = false;\n    this._reject(error);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}